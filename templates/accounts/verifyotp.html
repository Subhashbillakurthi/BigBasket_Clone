{% extends 'base.html' %}
{% load static %}
{% block content %}
  <div class="modal-overlay" id="login-modal-overlay" >
    <div class="login-modal">
      <div class="modal-left">
        <p class="why-title">Why choose Bigbasket?</p>
        <div class="why-list">
          <div class="why-row">
            <img src="{% static 'images/loginicon-1.png' %}" alt="iconimg">
            <div class="why-row-info">Quality</div>
          </div>
          <div class="why-row">
            <img src="{% static 'images/loginicon-2.png' %}" alt="iconimg">
            <div class="why-row-info">On time</div>
          </div>
          <div class="why-row">
            <img src="{% static 'images/loginicon-3.png' %}" alt="iconimg">
            <div class="why-row-info">Return Policy</div>
          </div>
          <div class="why-row">
            <img src="{% static 'images/loginicon-4.png' %}" alt="iconimg">
            <div class="why-row-info">Free delivery</div>
          </div>
        </div>
        <hr class="ticker">
        <div class="get-app">
          <span class="find-us">Find us on</span>
          <img src="{% static 'images/loginicon-5.png' %}" alt="Play" class="store-badge">
        </div>
      </div>

      <div class="modal-right">
        <a href="{% url 'home' %}" class="close-modal" id="close-modal">&times;</a>
        <div class="login-title">Otp</div>
        <div class="otp-caption">Enter the OTP sent to your email
          <hr class="otp-hr">
        </div>

        <!-- OTP form -->
        <form method="post">
          {% csrf_token %}
          <input type="text" class="login-input" name="otp" placeholder="Enter OTP" required>
          <button class="login-continue" type="submit">Continue</button>
          <div class="user-register">
            Re-enter Email! <a href="{% url 'send_otp' %}" class="register-link">Email-Login</a>
          </div>
        </form>

        <!-- ✅ Resend OTP button -->
        <form method="post" action="{% url 'resend_otp' %}" style="margin-top: 10px;">
          {% csrf_token %}
          <button class="login-continue1" type="submit" style="color: rgb(0, 0, 0);">Resend OTP</button>
        </form>

        <!-- Messages -->
        <div>
          {% if messages %}
            <ul class="messages">
              {% for message in messages %}
              <li class="{{ message.tags }}">
                {{ message }}
              </li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>
        <div>
          {% if error %}
            <p class="error-message" style="color: red;">{{ error }}</p>
          {% endif %}
        </div>

        <div class="login-info">
          By continuing, I accept TCP - 
          <a href="#" class="tnc-link">bigbasket's Terms and Conditions & Privacy Policy</a><br>
          This site is protected by reCAPTCHA and the Google
          <a href="#" class="tnc-link">- Privacy Policy</a> &amp;
          <a href="#" class="tnc-link">Terms of Service</a> apply.
        </div>
      </div>
    </div>
  </div>

  <!-- ✅ Optional: Cooldown Timer -->
  <script>
    const resendBtn = document.querySelector('form[action*="resend_otp"] button');
    let timer = 30; // seconds
    if (resendBtn) {
      resendBtn.disabled = true;
      const countdown = setInterval(() => {
        resendBtn.textContent = "Resend OTP (" + timer + "s)";
        timer--;
        if (timer < 0) {
          clearInterval(countdown);
          resendBtn.disabled = false;
          resendBtn.textContent = "Resend OTP";
        }
      }, 1000);
    }
  </script>
{% endblock %}
