{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="modal-overlay" id="login-modal-overlay">
  <div class="login-modal">
    <div class="modal-left">
      <p class="why-title">Why choose Bigbasket?</p>
      <div class="why-list">
        <div class="why-row">
          <img src="{% static 'images/loginicon-1.png' %}" alt="iconimg">
          <div class="why-row-info">Quality</div>
        </div>
        <div class="why-row">
          <img src="{% static 'images/loginicon-2.png' %}" alt="iconimg">
          <div class="why-row-info">On time</div>
        </div>
        <div class="why-row">
          <img src="{% static 'images/loginicon-3.png' %}" alt="iconimg">
          <div class="why-row-info">Return Policy</div>
        </div>
        <div class="why-row">
          <img src="{% static 'images/loginicon-4.png' %}" alt="iconimg">
          <div class="why-row-info">Free delivery</div>
        </div>
      </div>
      <hr class="ticker">
      <div class="get-app">
        <span class="find-us">Find us on</span>
        <img src="{% static 'images/loginicon-5.png' %}" alt="Play" class="store-badge">
      </div>
    </div>
    <div class="modal-right">
      <div>
        {% if messages %}
        <ul class="messages">
          {% for message in messages %}
          <li class="{{ message.tags }}">
            {{ message }}
          </li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>

      <a href="{% url 'home' %}" class="close-modal" id="close-modal">&times;</a>
      <div class="login-title">Register</div>
      <div class="otp-caption">Using Username & Password
        <hr class="otp-hr">
      </div>
      <form method="post">
        {% csrf_token %}
        <input type="text" class="login-input" name="username" placeholder="Enter User Id">
        <input type="text" class="login-input" id="gmailInput" name="email" placeholder="Enter Gmail Id" required>
        <span id="emailError" style="color:red; font-size:13px; display:none;">
          Please enter a valid Gmail address (example@gmail.com)
        </span>

        <select name="user_type" id="user_type" class="login-input">
          <option value="customer">customer</option>
          <option value="vendor">vendor</option>
        </select>
        <input type="password" class="login-input" name="password" placeholder="Password" required>
        <button class="login-continue" type="submit">Continue</button>
        <div class="user-register">Use ID login! <a href="{% url 'login' %}" class="register-link">IDLogin</a></div>
      </form>
      <div class="login-info">
        By continuing, I accept TCP -
        <a href="#" class="tnc-link">bigbasket's Terms and Conditions & Privacy Policy</a><br>
        This site is protected by reCAPTCHA and the Google
        <a href="#" class="tnc-link">- Privacy Policy</a> &amp;
        <a href="#" class="tnc-link">Terms of Service</a> apply.
      </div>
    </div>
  </div>
</div>

<script>
  const gmailInput = document.getElementById("gmailInput");
  const emailError = document.getElementById("emailError");

  // Relaxed regex: must start with a letter OR number, only letters/numbers/._- allowed, must end with @gmail.com
  const gmailRegex = /^[a-zA-Z0-9][a-zA-Z0-9._-]*@gmail\.com$/;

  gmailInput.addEventListener("input", function () {
    const value = gmailInput.value.trim();

    if (value === "") {
      // If empty, reset state
      emailError.style.display = "none";
      gmailInput.style.borderColor = "";
    } else if (gmailRegex.test(value)) {
      // Valid Gmail
      emailError.style.display = "none";
      gmailInput.style.borderColor = "green";
    } else {
      // Invalid Gmail
      emailError.style.display = "block";
      gmailInput.style.borderColor = "red";
    }
  });

  // Prevent form submission if invalid
  document.querySelector("form").addEventListener("submit", function (e) {
    if (!gmailRegex.test(gmailInput.value.trim())) {
      e.preventDefault();
      emailError.style.display = "block";
      gmailInput.style.borderColor = "red";
    }
  });
</script>

{% endblock %}